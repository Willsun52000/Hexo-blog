---
title: 解决的问题与现实挑战
category: 微服务
tag: 入门基础
date: 2017-03-26
---
严格意义上讲微服务并不是一种全新的架构模式，从发展轨迹上来看，它更像是基于SOA体系架构加上一些最佳实践，幻化出来的新变种。微服务摒弃了SOA中以ESB为中心的思想，服务粒度大小适中（粒度划分会在敏捷开发章节详细论述），采用轻量级的通信协议，吸收了敏捷开发方法论的核心思想和一系列成熟的平台工具和开发规范。
<!--more-->
下面的表格展示了微服务与SOA的区别：

|  微服务      |    SOA |
| :-------- | :--------|
| 使用大量小组件  | 	存在各别较复杂的组件 |
| 业务逻辑存在于单独的服务领域中     |   业务逻辑可以跨多个领域存在 |
| 使用简单的连接协议，例如HTTP与XML或JSON      |    企业服务产总线（ESB）充当了服务之间的层的角色 | 
| 通过SDK与客户端连接API      |    使用中间件 | 
微服务的一些优势是显而易见的：

- 每个服务都很简单，只关注于一个业务功能。在功能不变的情况下，应用被分解为多个可管理的分支或服务。每个服务都有一个用RPC-或者消息驱动API定义清楚的边界。微服务架构模式给采用单体式编码方式很难实现的功能提供了模块化的解决方案，由此，单个服务很容易开发、理解和维护。
- 每个微服务可以由不同的团队独立开发。这种架构使得每个服务都可以有专门开发团队来开发。开发者可以自由选择开发技术，提供API服务。当然，许多公司试图避免混乱，只提供某些技术选择。然后，这种自由意味着开发者不需要被迫使用某项目开始时采用的过时技术，他们可以选择现在的技术。甚至于，因为服务都是相对简单，即使用现在技术重写以前代码也不是很困难的事情。
- 微服务是松散耦合的。微服务架构模式是每个微服务独立的部署。开发者不再需要协调其它服务部署对本服务的影响。这种改变可以加快部署速度。UI团队可以采用AB测试，快速的部署变化。微服务架构模式使得持续化部署成为可能。
- 微服务可以通过不同的编程语言与工具进行开发。微服务架构模式使得每个服务独立扩展。你可以根据每个服务的规模来部署满足需求的规模。甚至于，你可以使用更适合于服务资源需求的硬件。比如，你可以在EC2 Compute Optimized instances上部署CPU敏感的服务，而在EC2 memory-optimized instances上部署内存数据库。

这些优势使得微服务看起来是非常完美的解决方案，不过微服务难道就没有缺点么？
- 运维成本过高。微服务强调服务粒度，将原有功能或服务拆分成耦合度低的服务组，这就需要对服务组中各个服务单独运维，增加了运维的难度。
- CICD是必须的。敏捷开发的引入要求服务的迭代速度前所未有的加快了，以适应瞬息万变的市场，这就导致了再开发耗时之外，不得不频繁的合并提交，部署上线，这在过去单靠人肉的时代是无法完成的任务，因此CICD是保证迭代顺利完成的关键。
-  接口不匹配。由于微服务间是以松耦合的契约规定服务调用方式的，服务方如果没有及时通知调用方接口的变化，会造成服务的调用的失败，甚至影响上线。
-  代码重复。为了避免将“同步耦合引入到系统中”，有时需要向不同服务添加一些代码，这就会导致代码重复，而代码重复是非常不好的，因为每个代码实例都需要进行测试和维护。一种解决方案是在服务间使用共享库，不过在多语言环境下这就行不通了，而且引入了耦合就意味着服务需要并行发布来维护彼此间的隐式接口。
-  分布式系统，异步的复杂性。分布式在微服务中的引入，在降低架构复杂度，解耦服务调用关系的同时，也带来了网络延迟，调用不确定性，分布式事务控制等一系列新挑战。
-  测试一个基于微服务架构的应用也是很复杂的任务。不只需要为每个服务建立基本的单体测试，还需要为了验证服务调用关系建立端到端的测试用例，在集成测试阶段还需要人工测试的同时尽可能多的用自动化测试化脚本覆盖到所有业务用例，这样才能尽可能保证快速迭代中，每次回归测试的自动化，降低迭代过程的测试成本。